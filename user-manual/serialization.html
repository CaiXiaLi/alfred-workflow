


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Serialization of stored/cached data &mdash; Alfred-Workflow 1.14 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Alfred-Workflow 1.14 documentation" href="../index.html"/>
        <link rel="up" title="User Manual" href="index.html"/>
        <link rel="next" title="Encoded strings and Unicode" href="text-encoding.html"/>
        <link rel="prev" title="“Magic” arguments" href="magic-arguments.html"/>
 
<!-- Only one of these will work. Seems a better solution than symlinking
the _static path in each subdirectory -->
<link rel="stylesheet" href="_static/gh-fork-ribbon.css">
<link rel="stylesheet" href="../_static/gh-fork-ribbon.css">
<link rel="stylesheet" href="_static/custom.css">
<link rel="stylesheet" href="../_static/custom.css">
<!--[if lt IE 9]>
	<link rel="stylesheet" href="_static/gh-fork-ribbon.ie.css">
<![endif]-->
<!-- <link rel="stylesheet" href="_static/custom.css"> -->
<!-- <link rel="shortcut icon" href="_static/favicon.ico"> -->


  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Alfred-Workflow
          

          
          </a>

          
            
            
              <div class="version">
                1.14
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Tutorial</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="osx-version-support.html">Supported OS X versions</a></li>
<li class="toctree-l2"><a class="reference internal" href="setup.html">Workflow setup and skeleton</a></li>
<li class="toctree-l2"><a class="reference internal" href="third-party.html">Including 3rd party libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="persistent-data.html">Persistent data</a></li>
<li class="toctree-l2"><a class="reference internal" href="filtering.html">Searching/filtering data</a></li>
<li class="toctree-l2"><a class="reference internal" href="web.html">Retrieving data from the web</a></li>
<li class="toctree-l2"><a class="reference internal" href="background.html">Background processes</a></li>
<li class="toctree-l2"><a class="reference internal" href="update.html">Self-updating</a></li>
<li class="toctree-l2"><a class="reference internal" href="versioning.html">Versioning and migration</a></li>
<li class="toctree-l2"><a class="reference internal" href="icons.html">System icons</a></li>
<li class="toctree-l2"><a class="reference internal" href="magic-arguments.html">&#8220;Magic&#8221; arguments</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Serialization of stored/cached data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#built-in-serializers">Built-in serializers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#managing-serializers">Managing serializers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#serializer-interface">Serializer interface</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="text-encoding.html">Encoded strings and Unicode</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">Alfred-Workflow API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../xml_format.html">Script Filter Results and the XML Format</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../aw-workflows.html">Workflows using Alfred-Workflow</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Alfred-Workflow</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">User Manual</a> &raquo;</li>
      
    <li>Serialization of stored/cached data</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/user-manual/serialization.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-workflow">
<span id="serialization-of-stored-cached-data"></span><span id="manual-serialization"></span><h1>Serialization of stored/cached data<a class="headerlink" href="#module-workflow" title="Permalink to this headline">¶</a></h1>
<p>By default, both cache and data files (created using the APIs described in
<a class="reference internal" href="persistent-data.html#manual-persistent-data"><span>Persistent data</span></a>) are cached using <a class="reference external" href="http://docs.python.org/2.7/library/pickle.html#module-cPickle" title="(in Python v2.7)"><code class="xref py py-mod docutils literal"><span class="pre">cPickle</span></code></a>. This provides
a great compromise in terms of speed and the ability to store arbitrary objects.</p>
<p>When changing or specifying a serializer, use the name under which the
serializer is registered with the <a class="reference internal" href="#managing-serializers"><span>workflow.manager</span></a>
object.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>When it comes to cache data, it is <em>strongly recommended</em> to stick with the
default. <a class="reference external" href="http://docs.python.org/2.7/library/pickle.html#module-cPickle" title="(in Python v2.7)"><code class="xref py py-mod docutils literal"><span class="pre">cPickle</span></code></a> is <em>very</em> fast and fully supports standard Python
data structures (<code class="docutils literal"><span class="pre">dict</span></code>, <code class="docutils literal"><span class="pre">list</span></code>, <code class="docutils literal"><span class="pre">tuple</span></code>, <code class="docutils literal"><span class="pre">set</span></code> etc.).</p>
<p>If you really must customise the cache data format, you can change the
default cache serialization format to <a class="reference external" href="http://docs.python.org/2.7/library/pickle.html#module-pickle" title="(in Python v2.7)"><code class="xref py py-mod docutils literal"><span class="pre">pickle</span></code></a> thus:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">wf</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">()</span>
<span class="n">wf</span><span class="o">.</span><span class="n">cache_serializer</span> <span class="o">=</span> <span class="s">&#39;pickle&#39;</span>
</pre></div>
</td></tr></table></div>
<p class="last">Unlike the stored data API, the cached data API can&#8217;t determine the format
of the cached data. If you change the serializer without clearing the
cache, errors will probably result as the serializer tries to load data
in a foreign format.</p>
</div>
<p>In the case of stored data, you are free to specify either a global default
serializer or one for each individual datastore:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">wf</span> <span class="o">=</span> <span class="n">Workflow</span><span class="p">()</span>
<span class="c"># Use `pickle` as the global default serializer</span>
<span class="n">wf</span><span class="o">.</span><span class="n">data_serializer</span> <span class="o">=</span> <span class="s">&#39;pickle&#39;</span>

<span class="c"># Use the JSON serializer only for these data</span>
<span class="n">wf</span><span class="o">.</span><span class="n">store_data</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">serializer</span><span class="o">=</span><span class="s">&#39;json&#39;</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>This is primarily so you can create files that are human-readable or useable
by other software. The generated JSON is formatted to make it readable.</p>
<p>The <a class="reference internal" href="../api/workflow.html#workflow.workflow.Workflow.stored_data" title="workflow.workflow.Workflow.stored_data"><code class="xref py py-meth docutils literal"><span class="pre">stored_data()</span></code></a> method can
automatically determine the serialization of the stored data (based on the file
extension, which is the same as the name the serializer is registered under),
provided the corresponding serializer is registered. If it isn&#8217;t, a
<code class="xref py py-class docutils literal"><span class="pre">ValueError</span></code> will be raised.</p>
<div class="section" id="built-in-serializers">
<h2>Built-in serializers<a class="headerlink" href="#built-in-serializers" title="Permalink to this headline">¶</a></h2>
<p>There are 3 built-in, pre-configured serializers:</p>
<ul class="simple">
<li><a class="reference internal" href="../api/serialization.html#workflow.workflow.CPickleSerializer" title="workflow.workflow.CPickleSerializer"><code class="xref py py-class docutils literal"><span class="pre">cpickle</span></code></a> — the default serializer
for both cached and stored data, with very good support for native Python
data types;</li>
<li><a class="reference internal" href="../api/serialization.html#workflow.workflow.PickleSerializer" title="workflow.workflow.PickleSerializer"><code class="xref py py-class docutils literal"><span class="pre">pickle</span></code></a> — a more flexible, but
much slower alternative to <code class="docutils literal"><span class="pre">cpickle</span></code>; and</li>
<li><a class="reference internal" href="../api/serialization.html#workflow.workflow.JSONSerializer" title="workflow.workflow.JSONSerializer"><code class="xref py py-class docutils literal"><span class="pre">json</span></code></a> — a very common data format,
but with limited support for native Python data types.</li>
</ul>
<p>See the built-in <a class="reference external" href="http://docs.python.org/2.7/library/pickle.html#module-cPickle" title="(in Python v2.7)"><code class="xref py py-mod docutils literal"><span class="pre">cPickle</span></code></a>, <a class="reference external" href="http://docs.python.org/2.7/library/pickle.html#module-pickle" title="(in Python v2.7)"><code class="xref py py-mod docutils literal"><span class="pre">pickle</span></code></a> and <a class="reference external" href="http://docs.python.org/2.7/library/json.html#module-json" title="(in Python v2.7)"><code class="xref py py-mod docutils literal"><span class="pre">json</span></code></a> libraries for
more information on the serialization formats.</p>
</div>
<div class="section" id="managing-serializers">
<span id="id1"></span><h2>Managing serializers<a class="headerlink" href="#managing-serializers" title="Permalink to this headline">¶</a></h2>
<p>You can add your own serializer, or replace the built-in ones, using the
configured instance of <a class="reference internal" href="../api/serialization.html#workflow.workflow.SerializerManager" title="workflow.workflow.SerializerManager"><code class="xref py py-class docutils literal"><span class="pre">SerializerManager</span></code></a> at
<code class="docutils literal"><span class="pre">workflow.manager</span></code>, e.g. <code class="docutils literal"><span class="pre">from</span> <span class="pre">workflow</span> <span class="pre">import</span> <span class="pre">manager</span></code>.</p>
<p>A <code class="docutils literal"><span class="pre">serializer</span></code> object must have <code class="docutils literal"><span class="pre">load()</span></code> and <code class="docutils literal"><span class="pre">dump()</span></code> methods that work
the same way as in the built-in <a class="reference external" href="http://docs.python.org/2.7/library/json.html#module-json" title="(in Python v2.7)"><code class="xref py py-mod docutils literal"><span class="pre">json</span></code></a> and <a class="reference external" href="http://docs.python.org/2.7/library/pickle.html#module-pickle" title="(in Python v2.7)"><code class="xref py py-mod docutils literal"><span class="pre">pickle</span></code></a> libraries, i.e.:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="c"># Reading</span>
<span class="n">obj</span> <span class="o">=</span> <span class="n">serializer</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">&#39;filename&#39;</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">))</span>
<span class="c"># Writing</span>
<span class="n">serializer</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;filename&#39;</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
<p>To register a new serializer, call the
<a class="reference internal" href="../api/serialization.html#workflow.workflow.SerializerManager.register" title="workflow.workflow.SerializerManager.register"><code class="xref py py-meth docutils literal"><span class="pre">register()</span></code></a> method of the
<code class="docutils literal"><span class="pre">workflow.manager</span></code> object with the name of the serializer and the object
that performs serialization:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre> <span class="kn">from</span> <span class="nn">workflow</span> <span class="kn">import</span> <span class="n">Workflow</span><span class="p">,</span> <span class="n">manager</span>


 <span class="k">class</span> <span class="nc">MySerializer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

     <span class="nd">@classmethod</span>
     <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">file_obj</span><span class="p">):</span>
         <span class="c"># load data from file_obj</span>

     <span class="nd">@classmethod</span>
     <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">file_obj</span><span class="p">):</span>
         <span class="c"># serialize obj to file_obj</span>

<span class="hll"> <span class="n">manager</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s">&#39;myformat&#39;</span><span class="p">,</span> <span class="n">MySerializer</span><span class="p">())</span>
</span></pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The name you specify for your serializer will be the file extension of the
stored files.</p>
</div>
</div>
<div class="section" id="serializer-interface">
<h2>Serializer interface<a class="headerlink" href="#serializer-interface" title="Permalink to this headline">¶</a></h2>
<p>A serializer <strong>must</strong> conform to this interface (like <a class="reference external" href="http://docs.python.org/2.7/library/json.html#module-json" title="(in Python v2.7)"><code class="xref py py-mod docutils literal"><span class="pre">json</span></code></a> and
<a class="reference external" href="http://docs.python.org/2.7/library/pickle.html#module-pickle" title="(in Python v2.7)"><code class="xref py py-mod docutils literal"><span class="pre">pickle</span></code></a>):</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">serializer</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file_obj</span><span class="p">)</span>
<span class="n">serializer</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">file_obj</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>See the <a class="reference internal" href="../api/serialization.html#api-serialization"><span>Serialization</span></a> section of the API documentation for more
information.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="text-encoding.html" class="btn btn-neutral float-right" title="Encoded strings and Unicode" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="magic-arguments.html" class="btn btn-neutral" title="“Magic” arguments" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Dean Jackson.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.14',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
  
<div class="github-fork-ribbon-wrapper right">
    <div class="github-fork-ribbon">
        <a href="https://github.com/deanishe/alfred-workflow">Fork me on GitHub</a>
    </div>
</div>
 


</body>
</html>